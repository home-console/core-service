# –ö–∞–∫ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–≥–∏–Ω PiKVM Client Service

## –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –∑–∞–≥—Ä—É–∑–∫–∏

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)

–ü–ª–∞–≥–∏–Ω **–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ core-service. PluginLoader —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `core-service/plugins/` –∏ –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –ø–ª–∞–≥–∏–Ω—ã.

### 2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞) ‚ö°

**–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–≥–∏–Ω –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —è–¥—Ä–∞!** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API endpoint –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–≥–∏–Ω–∞.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–≥–∏–Ω–∞

–ü–ª–∞–≥–∏–Ω –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```
PIKVMClientService/
‚îú‚îÄ‚îÄ __init__.py          # ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç PikvmClientPlugin
‚îú‚îÄ‚îÄ main.py              # ‚úÖ –ö–ª–∞—Å—Å PikvmClientPlugin(InternalPluginBase)
‚îú‚îÄ‚îÄ manifest.json        # ‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω–∞
‚îî‚îÄ‚îÄ src/                 # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
    ‚îú‚îÄ‚îÄ controllers/
    ‚îî‚îÄ‚îÄ settings.py
```

## –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)

### ‚ö†Ô∏è –ï—Å–ª–∏ –ø–ª–∞–≥–∏–Ω –Ω–µ –≤–∏–¥–µ–Ω –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

–ï—Å–ª–∏ –ø–ª–∞–≥–∏–Ω –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –≤ —Å–ø–∏—Å–∫–µ –ø–ª–∞–≥–∏–Ω–æ–≤, –µ–≥–æ –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ API:

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–≥–∏–Ω (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ –±—ã–ª –∑–∞–≥—Ä—É–∂–µ–Ω)
curl -X POST http://localhost:11000/api/plugins/pikvm_client/reload
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "data": {"plugin_id": "pikvm_client"},
  "message": "reloaded"
}
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–ª–∞–≥–∏–Ω –ø–æ—è–≤–∏—Ç—Å—è –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ!

### –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏)

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:11000
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ü–ª–∞–≥–∏–Ω—ã"
3. –ù–∞–π–¥–∏—Ç–µ "PiKVM Client Service" (—Ç–µ–ø–µ—Ä—å –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ)
4. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å" (–∏–ª–∏ "–í–∫–ª—é—á–∏—Ç—å" –µ—Å–ª–∏ –ø–ª–∞–≥–∏–Ω –æ—Ç–∫–ª—é—á–µ–Ω)

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ reload

1. –ï—Å–ª–∏ –ø–ª–∞–≥–∏–Ω —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω ‚Äî –æ–Ω –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è (`on_unload()`)
2. –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ (`on_load()`)
3. –†–æ—É—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. OpenAPI —Å—Ö–µ–º–∞ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ core-service

```bash
cd core-service
python -m core_service.main
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üîç Found X builtin plugin module(s)
üîÑ Attempting to load plugin from package: plugins.PIKVMClientService
‚úÖ Successfully loaded pikvm_client
```

### 3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–ª–∞–≥–∏–Ω —á–µ—Ä–µ–∑ API (–µ—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–≥–∏–Ω
curl -X POST http://localhost:11000/api/plugins/pikvm_client/reload
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ API

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ (—Ç–µ–ø–µ—Ä—å pikvm_client –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ)
curl http://localhost:11000/api/plugins

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –ø–ª–∞–≥–∏–Ω–µ
curl http://localhost:11000/api/plugins/pikvm_client

# Health check –ø–ª–∞–≥–∏–Ω–∞
curl http://localhost:11000/api/plugins/pikvm_client/health
```

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:11000 –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ü–ª–∞–≥–∏–Ω—ã". –ü–ª–∞–≥–∏–Ω `pikvm_client` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ API).

## –ï—Å–ª–∏ –ø–ª–∞–≥–∏–Ω –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–ª–∞–≥–∏–Ω –Ω–µ –≤–∏–¥–µ–Ω –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. **–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–ª–∞–≥–∏–Ω —á–µ—Ä–µ–∑ API:**
   ```bash
   curl -X POST http://localhost:11000/api/plugins/pikvm_client/reload
   ```
2. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. –ü–ª–∞–≥–∏–Ω –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤ —Å–ø–∏—Å–∫–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–ª–∞–≥–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞–ø–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `core-service/plugins/PIKVMClientService/`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –µ—Å—Ç—å `__init__.py` –∏ `main.py`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª–∞—Å—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `PikvmClientPlugin` –∏ –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `InternalPluginBase`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ core-service –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
   ```bash
   pip install -r requirements.txt
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º–ø–æ—Ä—Ç—ã –≤ `main.py` - –≤—Å–µ –ø—É—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –≤ on_load

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```bash
   export PIKVM_HOST=192.168.1.100
   export PIKVM_USERNAME=admin
   export PIKVM_PASSWORD=your_password
   ```
2. –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ UI –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü–ª–∞–≥–∏–Ω—ã" -> "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –†–æ—É—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `on_load()` —Å–æ–∑–¥–∞–µ—Ç—Å—è `self.router = APIRouter()`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–æ—É—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `self.router.add_api_route()`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–ª–∞–≥–∏–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è (—Å–º. –ª–æ–≥–∏)

## –†—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ Python (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–≥–∏–Ω –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ:

```python
from core_service.plugin_loader import PluginLoader

# –ü–æ–ª—É—á–∏—Ç—å plugin_loader –∏–∑ app.state
plugin_loader = app.state.plugin_loader

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–≥–∏–Ω
await plugin_loader.reload_plugin("pikvm_client")
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ load_plugin:

```python
await plugin_loader.load_plugin("plugins.PIKVMClientService", plugin_type="builtin")
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

‚úÖ **–ù–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å —è–¥—Ä–æ** ‚Äî –ø–ª–∞–≥–∏–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è "–Ω–∞ –ª–µ—Ç—É"  
‚úÖ **–ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** ‚Äî –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –ø–ª–∞–≥–∏–Ω–∞ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ  
‚úÖ **–ë–µ–∑ –ø—Ä–æ—Å—Ç–æ—è** ‚Äî –¥—Ä—É–≥–∏–µ –ø–ª–∞–≥–∏–Ω—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å  
‚úÖ **–£–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** ‚Äî –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –≤—Å–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ endpoints:

```bash
# –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–µ PiKVM
curl http://localhost:11000/api/plugins/pikvm_client/info

# –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è
curl http://localhost:11000/api/plugins/pikvm_client/power

# –í–∫–ª—é—á–∏—Ç—å –ø–∏—Ç–∞–Ω–∏–µ
curl -X POST http://localhost:11000/api/plugins/pikvm_client/power \
  -H "Content-Type: application/json" \
  -d '{"action": "on", "wait": false}'
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:11000
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ü–ª–∞–≥–∏–Ω—ã"
3. –ù–∞–π–¥–∏—Ç–µ "PiKVM Client Service"
4. –ù–∞–∂–º–∏—Ç–µ "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å"
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - `host`: IP –∞–¥—Ä–µ—Å PiKVM
   - `username`: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - `password`: –ü–∞—Ä–æ–ª—å
   - `enable_websocket`: true/false
6. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
7. –ü–ª–∞–≥–∏–Ω –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

